<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ESMI2 JF2 BM/PD 양식</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Unit 칸은 기본 숨김 */
    #unit-div { display: none; }
    /* 결과 영역은 기본 숨김 */
    #result-area { display: none; }
    /* 결과 텍스트 스타일 */
    #result-text { white-space: pre-wrap; background:#f8f9fa; padding:1rem; border-radius:.25rem; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4">ESMI2 JF2 BM/PD 양식</h1>
    <form id="main-form">
      <!-- 1. 종류 -->
      <div class="mb-3">
        <label for="kind" class="form-label">종류</label>
        <input type="text" class="form-control" id="kind" placeholder="예: BM/PD/재료교체 등" required>
      </div>

      <!-- 2. 호기 · 공정 -->
      <div class="row mb-3">
        <div class="col">
          <label for="machine" class="form-label">호기</label>
          <select id="machine" class="form-select" required>
            <option value="">-- 선택하세요 --</option>
            <option>3-1</option>
            <option>3-2</option>
            <option>3-3</option>
            <option>3-4</option>
            <option>3-5</option>
            <option>3-H</option>
          </select>
        </div>
        <div class="col">
          <label for="process" class="form-label">공정</label>
          <select id="process" class="form-select" required>
            <option value="">-- 선택하세요 --</option>
            <option value="ESP">ESP</option>
            <option value="Lamination">Lamination</option>
            <option value="D-Stacking">D-Stacking</option>
            <option value="Taping">Taping</option>
            <option value="Inspection">Inspection</option>
          </select>
        </div>
      </div>

      <!-- 3. 동적 Unit 선택 -->
      <div id="unit-div" class="mb-3">
        <label for="unit" class="form-label">Unit</label>
        <select id="unit" class="form-select" required>
          <!-- 스크립트가 여기에 옵션을 채워 넣습니다 -->
        </select>
      </div>

      <!-- 4. 발생시간 · 조치완료시간 -->
      <div class="row mb-3">
        <div class="col">
          <label for="occur" class="form-label">발생시간</label>
          <input type="datetime-local" class="form-control" id="occur" required>
        </div>
        <div class="col">
          <label for="complete" class="form-label">조치완료시간</label>
          <input type="datetime-local" class="form-control" id="complete" required>
        </div>
      </div>

      <!-- 5. 작업자 -->
      <div class="mb-3">
        <label for="operator" class="form-label">작업자</label>
        <input type="text" class="form-control" id="operator" placeholder="작업자 이름" required>
      </div>

      <!-- 6. 현상 -->
      <div class="mb-3">
        <label for="symptom" class="form-label">현상</label>
        <textarea id="symptom" class="form-control" rows="4" required></textarea>
      </div>

      <!-- 7. 원인 -->
      <div class="mb-3">
        <label for="cause" class="form-label">원인</label>
        <textarea id="cause" class="form-control" rows="2" required></textarea>
      </div>

      <!-- 8. 조치 -->
      <div class="mb-3">
        <label for="action" class="form-label">조치</label>
        <textarea id="action" class="form-control" rows="4" required></textarea>
      </div>

      <!-- 9. 제출 버튼 -->
      <button type="submit" class="btn btn-primary">제출</button>
    </form>

    <!-- 10. 결과 영역 -->
    <div id="result-area" class="mt-5">
      <h5>결과</h5>
      <pre id="result-text"></pre>
      <button id="copy-btn" class="btn btn-secondary">복사</button>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- 동적 처리 스크립트 -->
  <script>
    // 공정별 Unit 목록
    const unitOptions = {
      ESP: ['01. Electrode. Unwinder'],
      Lamination: [
        '01. Separator.Unwinder',
        '02. Electrode/Separator. Combiner',
        '03. Laminator',
        '04. Cell.Final Cutter',
        '05. Cell.Tracking System',
        '06. Cell.Inspector',
        '07. Cell.Unloader',
        '08. Common'
      ],
      'D-Stacking': [
        '01. Monocell.Loading Conveyor',
        '02. Monocell.Stacker',
        '03. Stacked Cell.Transfer'
      ],
      Taping: [
        '01. Shuttle',
        '02. Half Cell.Loading',
        '03. Half Cell.Stack',
        '04. Stacked Cell.Taper[1]',
        '05. Stacked Cell.Rotator',
        '06. Stacked Cell.Taper[2]'
      ],
      Inspection: [
        '01. Taped Cell.Inspection',
        '02. Taped Cell.Transfer',
        '03. NG Taped Cell.Transfer',
        '04. Taped Cell.Unloader',
        '05. Common'
      ]
    };

    const processSelect = document.getElementById('process');
    const unitDiv       = document.getElementById('unit-div');
    const unitSelect    = document.getElementById('unit');
    const form          = document.getElementById('main-form');
    const resultArea    = document.getElementById('result-area');
    const resultText    = document.getElementById('result-text');
    const copyBtn       = document.getElementById('copy-btn');

    // 페이지 로드 시 현재 시간 자동 채우기
    window.addEventListener('DOMContentLoaded', () => {
      const now = new Date();
      const tzOffset = now.getTimezoneOffset() * 60000;
      const localISO = new Date(now - tzOffset).toISOString().slice(0,16);
      document.getElementById('occur').value    = localISO;
      document.getElementById('complete').value = localISO;
    });

    // 공정 선택 시 Unit 토글
    processSelect.addEventListener('change', () => {
      const sel = processSelect.value;
      unitSelect.innerHTML = '';
      unitDiv.style.display = 'none';

      if (unitOptions[sel]) {
        unitOptions[sel].forEach(text => {
          const opt = document.createElement('option');
          opt.value = text;
          opt.text  = text;
          unitSelect.appendChild(opt);
        });
        unitDiv.style.display = 'block';
      }
    });

    // 폼 제출 처리
    form.addEventListener('submit', event => {
      event.preventDefault();
      const kind     = document.getElementById('kind').value;
      const machine  = document.getElementById('machine').value;
      const process  = processSelect.value;
      const unit     = unitSelect.value;
      const occurVal = document.getElementById('occur').value;
      const completeVal = document.getElementById('complete').value;
      const operator = document.getElementById('operator').value;
      const symptom  = document.getElementById('symptom').value;
      const cause    = document.getElementById('cause').value;
      const action   = document.getElementById('action').value;

      function formatKoreanDatetime(val) {
        const d = new Date(val);
        const year  = d.getFullYear();
        const month = d.getMonth() + 1;
        const date  = d.getDate();
        let hour    = d.getHours();
        const minute = String(d.getMinutes()).padStart(2, '0');
        const ampm   = hour >= 12 ? '오후' : '오전';
        hour = hour % 12 || 12;
        return `${year}년 ${month}월 ${date}일 ${ampm} ${hour}:${minute}`;
      }

      const occur    = formatKoreanDatetime(occurVal);
      const complete = formatKoreanDatetime(completeVal);

      const text = 
`[부동&작업 공유]
종류: ${kind}
호기: ${machine}
공정: ${process}
Unit: ${unit}
발생시간: ${occur}
조치완료: ${complete}
작업자: ${operator}
현상: ${symptom}
원인: ${cause}
조치: ${action}`;

      resultText.textContent = text;
      resultArea.style.display = 'block';
      resultArea.scrollIntoView({ behavior: 'smooth' });
    });

    // 복사 버튼
    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(resultText.textContent)
        .then(() => alert('클립보드에 복사되었습니다!'))
        .catch(() => alert('복사에 실패했습니다.'));
    });
  </script>
</body>
</html>